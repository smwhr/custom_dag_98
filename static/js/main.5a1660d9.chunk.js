(this["webpackJsonpcustom-dag-98"]=this["webpackJsonpcustom-dag-98"]||[]).push([[0],{17:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var i=n(8),c=(n(17),n(18),n(1));let a=(e,t)=>Array.from({length:t-e+1},((t,n)=>e+n));var l=n.p+"static/media/initial.eca51b8e.png",s=n(2),r=n(0);const j=e=>{let{children:t}=e;return Object(r.jsx)(s.a,{width:8,height:2,children:t})},o=e=>{let{children:t}=e;return Object(r.jsx)(s.a,{height:1,top:4,left:5,width:8,style:{textAlign:"right"},children:t})},d=e=>{let{onNext:t,cancel:n}=e;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("p",{children:"This wizard will help you create your custom DAG quickly and easily."}),Object(r.jsx)("p",{children:"To begin creating your custom DAG, click Next."})]}),Object(r.jsxs)(o,{children:[Object(r.jsx)("button",{disabled:!0,children:"< Back"}),Object(r.jsx)("button",{onClick:t,children:"Next >"}),"\xa0",Object(r.jsx)("button",{onClick:n,style:{marginLeft:"1em"},children:"Cancel"})]})]})},b=e=>{let{initialAgency:t,availableAgencies:n,onBack:i,onAgency:a,cancel:l}=e,[s,d]=Object(c.useState)(t);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("h2",{children:"Select Agency"}),Object(r.jsx)("p",{children:"Select the agency :"}),Object(r.jsx)("div",{children:Object(r.jsx)("select",{onChange:e=>d(e.target.value),defaultValue:t,children:n.map((e=>Object(r.jsx)("option",{value:e,children:e},e)))})})]}),Object(r.jsxs)(o,{children:[Object(r.jsx)("button",{onClick:i,children:"< Back"}),Object(r.jsx)("button",{onClick:()=>{a(s)},children:"Next >"}),"\xa0",Object(r.jsx)("button",{onClick:l,style:{marginLeft:"1em"},children:"Cancel"})]})]})};function h(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.name=e,this.label=t,this.key=e,this.value=i,this.toggle=()=>{this.value=!this.value},this.render=()=>Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{id:"task_".concat(this.name),type:"checkbox",value:this.name,checked:this.value,onClick:()=>this.toggle(),onChange:n},this.name),Object(r.jsx)("label",{htmlFor:"task_".concat(this.name),children:this.label})]},"task_".concat(this.key))}const m=[{id:"1",name:"January"},{id:"2",name:"February"},{id:"3",name:"March"},{id:"4",name:"April"},{id:"5",name:"May"},{id:"6",name:"June"},{id:"7",name:"July"},{id:"8",name:"August"},{id:"9",name:"September"},{id:"10",name:"October"},{id:"11",name:"November"},{id:"12",name:"December"}],u=e=>{let{initialPerimeter:t,availableYears:n,onBack:i,onTimePerimeter:l,cancel:d}=e;const b="string"===typeof t?"all":0===t.length?"none":"year_month",u="year_month"===b?t[0].split("_")[0]:n[0],x=Array.isArray(t)?t.map((e=>e.split("_")[1])):[];let[O,p]=Object(c.useState)(b),[g,k]=Object(c.useState)(u),[y,v]=Object(c.useState)(x);const C=m.map((e=>{let{id:t,name:n}=e;return new h(t,n,(()=>{const e=_.filter((e=>e.value)).map((e=>e.name));v(e),f.value=0===e.length,w.value=12===e.length}),y.includes(t))}));let[_]=Object(c.useState)(C),[w]=Object(c.useState)(new h("all","Select all",(()=>{_.map((e=>(e.value=!0,e))),w.value=!0,f.value=!1,v(m.map((e=>{let{id:t}=e;return t})))}))),[f]=Object(c.useState)(new h("none","Deselect all",(()=>{_.map((e=>(e.value=!1,e))),f.value=!0,w.value=!1,v([])})));return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("h2",{children:"Select time perimeter"}),Object(r.jsxs)("fieldset",{disabled:"year_month"!==O,children:[Object(r.jsxs)("legend",{children:[Object(r.jsx)("input",{type:"radio",id:"year_month_perimeter_type",name:"time_perimeter_type",value:"year_month",checked:"year_month"===O,onChange:e=>p(e.target.value)}),Object(r.jsx)("label",{htmlFor:"year_month_perimeter_type",children:"Use a specific time perimeter (Recommended)"})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("label",{children:"Please choose a year :"}),Object(r.jsx)("select",{onChange:e=>k(parseInt(e.target.value,10)),children:n.map((e=>Object(r.jsx)("option",{value:e,children:e},e)))})]}),Object(r.jsxs)("fieldset",{children:[Object(r.jsx)("legend",{children:"Months"}),Object(r.jsxs)(s.b,{children:[Object(r.jsx)(s.a,{width:4,children:_.slice(0,5).map((e=>e.render()))}),Object(r.jsx)(s.a,{width:4,children:_.slice(5,10).map((e=>e.render()))}),Object(r.jsxs)(s.a,{width:4,children:[_.slice(10,12).map((e=>e.render())),Object(r.jsx)("br",{}),w.render(),f.render()]})]})]})]}),Object(r.jsx)("input",{type:"radio",id:"all_perimeter_type",name:"time_perimeter_type",value:"all",checked:"all"===O,onChange:e=>p(e.target.value)}),Object(r.jsx)("label",{htmlFor:"all_perimeter_type",children:"Launch on all available year and months (Slow)"}),Object(r.jsx)("input",{type:"radio",id:"none_perimeter_type",name:"time_perimeter_type",value:"none",checked:"none"===O,onChange:e=>p(e.target.value)}),Object(r.jsx)("label",{htmlFor:"none_perimeter_type",children:"Only compute the referential (Fast)"})]}),Object(r.jsxs)(o,{children:[Object(r.jsx)("button",{onClick:i,children:"< Back"}),Object(r.jsx)("button",{onClick:()=>{if("year_month"===O){const e="".concat(g),t=0===y.length?a(1,12).map((t=>"".concat(e,"_").concat(t))):y.map((t=>"".concat(e,"_").concat(t)));l(t)}else"all"===O?l("all"):"none"===O&&l([])},children:"Next >"}),"\xa0",Object(r.jsx)("button",{onClick:d,style:{marginLeft:"1em"},children:"Cancel"})]})]})},x=e=>{let{initialTasks:t,availableTasks:n,onBack:i,cancel:a,onTasks:l}=e,[s,d]=Object(c.useState)(t);const b=n.map((e=>new h(e,e,(()=>{d(m.filter((e=>e.value)).map((e=>e.name)))}),t.includes(e))));let[m]=Object(c.useState)(b);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("h2",{children:"Select Tasks"}),Object(r.jsx)("p",{children:"Select the task(s) to :"}),Object(r.jsx)("div",{children:m.map((e=>e.render()))})]}),Object(r.jsxs)(o,{children:[Object(r.jsx)("button",{onClick:i,children:"< Back"}),Object(r.jsx)("button",{onClick:()=>{l(s)},disabled:s.length<1,children:"Next >"}),"\xa0",Object(r.jsx)("button",{onClick:a,style:{marginLeft:"1em"},children:"Cancel"})]})]})},O=e=>{let{initialKpi:t,availableKpis:n,onBack:i,cancel:a,onKpi:l}=e,[s,d]=Object(c.useState)(t);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("h2",{children:"Select Kpi"}),Object(r.jsx)("p",{children:"Select the kpi :"}),Object(r.jsx)("div",{children:Object(r.jsx)("select",{onChange:e=>d(e.target.value),defaultValue:t,children:n.map((e=>Object(r.jsx)("option",{value:e,children:e},e)))})})]}),Object(r.jsxs)(o,{children:[Object(r.jsx)("button",{onClick:i,children:"< Back"}),Object(r.jsx)("button",{onClick:()=>{l(s)},children:"Next >"}),"\xa0",Object(r.jsx)("button",{onClick:a,style:{marginLeft:"1em"},children:"Cancel"})]})]})},p=e=>{let{onBack:t,onNext:n,cancel:i}=e;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("h2",{children:"Wizard completed"}),Object(r.jsx)("p",{children:"The custom DAG wizard saved all informations."}),Object(r.jsx)("p",{children:"Click Finish to generate your custom DAG json."}),Object(r.jsx)("div",{style:{marginTop:"5em"}}),Object(r.jsxs)(s.b,{children:[Object(r.jsx)(s.a,{width:6,children:Object(r.jsx)("button",{disabled:!0,children:"Add custom builds"})}),Object(r.jsx)(s.a,{width:6,center:!0,middle:!0}),Object(r.jsx)(s.a,{width:6,children:Object(r.jsx)("button",{disabled:!0,children:"Add a custom notification"})}),Object(r.jsx)(s.a,{width:6,center:!0,middle:!0})]})]}),Object(r.jsxs)(o,{children:[Object(r.jsx)("button",{onClick:t,children:"< Back"}),Object(r.jsx)("button",{onClick:n,children:"Finish"}),"\xa0",Object(r.jsx)("button",{onClick:i,style:{marginLeft:"1em"},children:"Cancel"})]})]})};var g=n(12);const k=e=>{let{customDag:t,onBack:n}=e;const i=JSON.stringify((e=>{var t;let n={};return console.log(e.tasks.includes("initialize-kpis")),(null===(t=e.kpi)||void 0===t?void 0:t.length)>0&&e.tasks.includes("initialize-kpis")&&(n={kpi:e.kpi}),console.log(n),{[e.agency]:{time_perimeter:e.time_perimeter,tasks:e.tasks,...n}}})(t));return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(j,{children:[Object(r.jsx)("textarea",{style:{width:"100%",height:"220px"},value:i,readOnly:!0}),Object(r.jsx)(g.CopyToClipboard,{text:i,children:Object(r.jsx)("button",{children:"Copy to clipboard"})})]}),Object(r.jsx)(o,{children:Object(r.jsx)("button",{onClick:n,children:"Cancel"})})]})},y={};function v(e,t){switch(t.type){case"reset":return{};case"agency":return{...e,agency:t.payload};case"time_perimeter":return{...e,time_perimeter:t.payload};case"tasks":return{...e,tasks:t.payload};case"kpi":return{...e,kpi:t.payload};default:throw new Error}}function C(){let[e,t]=Object(c.useState)([]),[n,i]=Object(c.useState)([]),[o,h]=Object(c.useState)("loading");const[m,g]=Object(c.useReducer)(v,y);Object(c.useEffect)((()=>{console.log("Fetching agencies");const e=fetch("https://django.gateway.staging.cit.io/agencies/").then((e=>e.json())).then((e=>e.map((e=>e.name)))).then((e=>t(e.sort())));console.log("Fetching kpis");const n=fetch("https://docs.api.staging.cit.io/_sources/api/kpis.rst.txt").then((e=>e.text())).then((e=>e.match(/kpis\.(.*)/g))).then((e=>e.map((e=>e.split(".")[1])))).then((e=>{i(e.sort())}));Promise.all([e,n]).then((()=>h("initial")))}),[]);const C=a(2018,(new Date).getFullYear()).reverse(),_=["write-ctfs-to-gcloud","initialize-ctfs","clean-models","initialize-cs-models","initialize-kpis","initialize-serialized-courses","initialize-service-dates","generate-report","clusterize-kpis","run-prediction"],w=()=>{g({type:"reset"}),h("initial")},f=Object(c.useRef)(null),[z,S]=Object(c.useState)("normal");return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsxs)("div",{className:"window",ref:f,style:{width:"normal"===z?"490px":"minimized"===z?"200px":"maximized"===z?"100%":"480px"},children:[Object(r.jsxs)("div",{className:"title-bar",children:[Object(r.jsx)("div",{className:"title-bar-text",children:"Custom DAG Wizard"}),Object(r.jsxs)("div",{className:"title-bar-controls",children:["minimized"!==z?Object(r.jsx)("button",{"aria-label":"Minimize",onClick:()=>{S("minimized")}}):null,"maximized"!==z&&"minimized"!==z?Object(r.jsx)("button",{"aria-label":"Maximize",onClick:()=>{S("maximized")}}):null,"normal"!==z?Object(r.jsx)("button",{"aria-label":"Restore",onClick:()=>{S("normal")}}):null,Object(r.jsx)("button",{"aria-label":"Close",onClick:()=>{window.confirm("Are you sure your want to quit the wizard ?")&&f.current.remove()}})]})]}),Object(r.jsx)("div",{className:"window-body",style:{display:"minimized"===z?"none":"block"},children:Object(r.jsxs)(s.b,{columns:12,flow:"row dense",children:[Object(r.jsx)(s.a,{width:4,height:4,children:Object(r.jsx)("img",{src:l,alt:""})}),Object(r.jsx)(r.Fragment,{children:"loading"===o?Object(r.jsxs)(j,{children:["Preparing the wizard... ",Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),"Agencies ",0===e.length?"loading...":"loaded."," ",Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),"KPI ",0===n.length?"loading...":"loaded."]}):"initial"===o?Object(r.jsx)(d,{onNext:()=>{h("agency")},cancel:w}):"agency"===o?(()=>{const t=m.agency||e[0]||"";return Object(r.jsx)(b,{initialAgency:t,availableAgencies:e,onBack:()=>{h("initial")},cancel:w,onAgency:e=>{g({type:"agency",payload:e}),h("date")}})})():"date"===o?(()=>{const e=m.time_perimeter||["".concat(C[0],"_").concat((new Date).getMonth())];return Object(r.jsx)(u,{initialPerimeter:e,availableYears:C,onBack:()=>{h("agency")},cancel:w,onTimePerimeter:e=>{g({type:"time_perimeter",payload:e}),h("task")}})})():"task"===o?(()=>{const e=m.tasks||[];return Object(r.jsx)(x,{initialTasks:e,availableTasks:_,onBack:()=>{h("date")},cancel:w,onTasks:e=>{g({type:"tasks",payload:e}),e.includes("initialize-kpis")?h("kpi"):h("end")}})})():"kpi"===o?(()=>{const e=m.kpi||n[0]||"";return Object(r.jsx)(O,{initialKpi:e,availableKpis:n,onBack:()=>{h("task")},cancel:w,onKpi:e=>{g({type:"kpi",payload:e}),h("end")}})})():"end"===o?Object(r.jsx)(p,{onBack:()=>{h("task")},onNext:()=>{h("json")},cancel:w}):"json"===o?Object(r.jsx)(k,{customDag:m,onBack:()=>{h("end")}}):Object(r.jsx)("p",{children:"Step undefined !"})})]})})]}),Object(r.jsx)("div",{})]})}const _=document.getElementById("root");Object(i.render)(Object(r.jsx)(C,{}),_)}},[[25,1,2]]]);
//# sourceMappingURL=main.5a1660d9.chunk.js.map